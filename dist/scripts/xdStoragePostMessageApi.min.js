var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,f,g){if(g.get||g.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[f]=g.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var f=0;return $jscomp.iteratorPrototype(function(){return f<b.length?{done:!1,value:b[f++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(b,f){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var g=0,h={next:function(){if(g<b.length){var l=g++;return{value:f(l,b[l]),done:!1}}h.next=function(){return{done:!0,value:void 0}};return h.next()}};h[Symbol.iterator]=function(){return h};return h};
$jscomp.polyfill=function(b,f,g,h){if(f){g=$jscomp.global;b=b.split(".");for(h=0;h<b.length-1;h++){var l=b[h];l in g||(g[l]={});g=g[l]}b=b[b.length-1];h=g[b];f=f(h);f!=h&&null!=f&&$jscomp.defineProperty(g,b,{configurable:!0,writable:!0,value:f})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6-impl","es3");
(function(){function b(c,a){var b=XdUtils.extend(a,h);b.id=c;parent.postMessage(JSON.stringify(b),"*")}function f(c){var a;try{a=JSON.parse(c.data)}catch(e){return}try{var d=localStorage.length,d=sessionStorage.length;console.log("Test storage blocking"+d)}catch(e){b(a.id,{normal_response:!1,error:e.toString()});return}a&&"cross-domain-local-message"===a.namespace&&("local"==a.type&&("set"===a.action?n.setData(a.id,a.key,a.value):"get"===a.action?n.getData(a.id,a.key):"remove"===a.action?n.removeData(a.id,
a.key):"key"===a.action?n.getKey(a.id,a.key):"size"===a.action?n.getSize(a.id):"length"===a.action?n.getLength(a.id):"clear"===a.action&&n.clear(a.id)),"session"==a.type&&("set"===a.action?m.setData(a.id,a.key,a.value):"get"===a.action?m.getData(a.id,a.key):"remove"===a.action?m.removeData(a.id,a.key):"key"===a.action?m.getKey(a.id,a.key):"size"===a.action?m.getSize(a.id):"length"===a.action?m.getLength(a.id):"clear"===a.action?m.clear(a.id):"sync"===a.action?m.syncManual(a.id,a.key):"option"===a.action&&
"auto-sync"==a.key&&(l=a.value,b(a.id,{}))))}function g(c){if(null!=c.newValue&&"cross-domain-storage-sync"==c.key){var a;try{a=JSON.parse(c.newValue)}catch(e){return}if("request"==a.type){var d=[];if(null==a.keys||"string"!=typeof a.keys||0==a.keys.trim().length)for(c=0;c<sessionStorage.length;c++)d.push(sessionStorage.key(c));else d=JSON.parse(a.keys);a={type:"response",id:a.id,keys:d,hash:{}};for(c=0;c<d.length;c++)a.hash[d[c]]=sessionStorage.getItem(d[c]);localStorage.setItem("cross-domain-storage-sync",
JSON.stringify(a));localStorage.removeItem("cross-domain-storage-sync")}else if("response"==a.type)if(a.keys&&a.keys.length){for(c=0;c<a.keys.length;c++)null==a.hash[a.keys[c]]?sessionStorage.removeItem(a.keys[c]):sessionStorage.setItem(a.keys[c],a.hash[a.keys[c]]);a.id?(0==p&&(p=(new Date).getTime()),k[a.id]&&(clearTimeout(k[a.id]),delete k[a.id]),b(a.id,{status:0,message:"sync completed"})):"auto"==a.method&&b(null,{status:0,keys:a.keys,hash:a.hash})}else a.id&&(0==p&&(p=(new Date).getTime()),k[a.id]&&
(clearTimeout(k[a.id]),delete k[a.id]),b(a.id,{status:2,message:"nothing to sync  "+JSON.stringify(a)}))}}var h={namespace:"cross-domain-local-message",normal_response:!0},l=!1,p=0,k={},n={getData:function(c,a){if(Array.isArray(a)){for(var d=[],e=0;e<a.length;e++)d.push(localStorage.getItem(a[e]));b(c,{key:a,value:d})}else b(c,{key:a,value:localStorage.getItem(a)})},setData:function(c,a,d){if(Array.isArray(a)){for(var e=[],g,f=0;f<a.length;f++)localStorage.setItem(a[f],d[f]),g=d[f]===localStorage.getItem(a[f]),
e.push(g);b(c,{key:a,success:e})}else localStorage.setItem(a,d),b(c,{success:localStorage.getItem(a)===d})},removeData:function(c,a){if(Array.isArray(a))for(var d=0;d<a.length;d++)localStorage.removeItem(a[d]);else localStorage.removeItem(a);b(c,{})},getKey:function(c,a){if(Array.isArray(a)){for(var d=[],e=0;e<a.length;e++)d.push(localStorage.key(a[e]));b(c,{key:d})}else b(c,{key:localStorage.key(a)})},getSize:function(c){var a=JSON.stringify(localStorage).length;b(c,{size:a})},getLength:function(c){b(c,
{length:localStorage.length})},clear:function(c){localStorage.clear();b(c,{})}},m={getData:function(c,a){if(Array.isArray(a)){for(var d=[],e=0;e<a.length;e++)d.push(sessionStorage.getItem(a[e]));b(c,{key:a,value:d})}else b(c,{key:a,value:sessionStorage.getItem(a)})},setData:function(c,a,d){if(Array.isArray(a)){for(var e=[],f=[],g=[],h,k=0;k<a.length;k++)sessionStorage.setItem(a[k],d[k]),h=d[k]===sessionStorage.getItem(a[k]),e.push(h),h&&(f.push(a[k]),g.push(d[k]));l&&0<f.length&&m.syncAuto(f,g);b(c,
{key:a,success:e})}else sessionStorage.setItem(a,d),e={success:sessionStorage.getItem(a)===d},l&&e.success&&m.syncAuto(a,d),b(c,e)},removeData:function(c,a){if(Array.isArray(a))for(var d=0;d<a.length;d++)sessionStorage.removeItem(a[d]);else sessionStorage.removeItem(a);l&&m.syncAuto(a,null);b(c,{})},getKey:function(c,a){if(Array.isArray(a)){for(var d=[],e=0;e<a.length;e++)d.push(sessionStorage.key(a[e]));b(c,{key:d})}else b(c,{key:sessionStorage.key(a)})},getSize:function(c){var a=JSON.stringify(sessionStorage).length;
b(c,{size:a})},getLength:function(c){b(c,{length:sessionStorage.length})},clear:function(c){l&&m.syncAuto(null,null);sessionStorage.clear();b(c,{})},syncManual:function(c,a){var d={type:"request",method:"manual",id:c,keys:a,time:(new Date).getTime()};try{localStorage.setItem("cross-domain-storage-sync",JSON.stringify(d)),localStorage.removeItem("cross-domain-storage-sync")}catch(e){b(c,{status:1,message:e});return}k[c]=setTimeout(function(){delete k[c];b(c,{status:1,message:"timed out"})},1E3)},syncAuto:function(b,
a){var c,e={type:"response",method:"auto",id:null,keys:[],hash:{}};if(null!=b)if(Array.isArray(b))for(c=0;c<b.length;c++)e.keys.push(b[c]),e.hash[b[c]]=a[c];else e.keys.push(b),e.hash[b]=a;else{var f;for(c=0;c<sessionStorage.length;c++)f=sessionStorage.key(c),e.keys.push(f),e.hash[f]=null}localStorage.setItem("cross-domain-storage-sync",JSON.stringify(e));localStorage.removeItem("cross-domain-storage-sync")}};window.addEventListener?(window.addEventListener("message",f,!1),window.addEventListener("storage",
g,!1)):(window.attachEvent("onmessage",f),window.attachEvent("onstorage",g));parent.postMessage(JSON.stringify({namespace:"cross-domain-local-message",id:"iframe-ready"}),"*")})();
